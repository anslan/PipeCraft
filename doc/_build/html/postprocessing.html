<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta content="PipeCraft manual. tutorial" lang="en" name="description" xml:lang="en" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Post-processing tools &mdash; PipeCraft2 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example data analyses" href="tutorial.html" />
    <link rel="prev" title="Individual steps (Quick Tools)" href="quicktools.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PipeCraft2
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="pre-defined_pipelines.html">Pre-defined pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="quicktools.html">Individual steps (Quick Tools)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Post-processing tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#postprocessing-lulu">LULU</a></li>
<li class="toctree-l2"><a class="reference internal" href="#postprocessing-deicode">DEICODE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Example data analyses</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshoot.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="licence.html">Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker_images.html">Docker images</a></li>
<li class="toctree-l1"><a class="reference internal" href="for_developers.html">For Developers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PipeCraft2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Post-processing tools</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/postprocessing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <style> .red {color:#ff0000; font-weight:bold; font-size:16px} </style><style> .green {color:#00f03d; font-weight:bold; font-size:16px} </style><dl class="simple">
<dt><a class="reference internal" href="_images/PipeCraft2_icon_v2.png"><img alt="Alternative text" src="_images/PipeCraft2_icon_v2.png" style="width: 100px;" /></a></dt><dd><p><a class="reference external" href="https://github.com/pipecraft2/pipecraft">github</a></p>
</dd>
</dl>
<section id="post-processing-tools">
<span id="postprocessingtools"></span><h1><a class="toc-backref" href="#id3" role="doc-backlink">Post-processing tools</a><a class="headerlink" href="#post-processing-tools" title="Permalink to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All post-processing tools accessible under <strong>ADD STEP</strong> -&gt; <strong>POSTPROCESSING</strong></p>
</div>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#post-processing-tools" id="id3">Post-processing tools</a></p>
<ul>
<li><p><a class="reference internal" href="#postprocessing-lulu" id="id4">LULU</a></p></li>
<li><p><a class="reference internal" href="#postprocessing-deicode" id="id5">DEICODE</a></p></li>
</ul>
</li>
</ul>
</nav>
<hr class="docutils" />
<section id="postprocessing-lulu">
<span id="id1"></span><h2><a class="reference external" href="https://github.com/tobiasgf/lulu">LULU</a><a class="headerlink" href="#postprocessing-lulu" title="Permalink to this heading"></a></h2>
<p>LULU description from the <a class="reference external" href="https://github.com/tobiasgf/lulu">LULU repository</a>: the purpose of LULU is to reduce the number of
erroneous OTUs in OTU tables to achieve more realistic biodiversity metrics.
By evaluating the co-occurence patterns of OTUs among samples LULU identifies OTUs that consistently satisfy some user selected
criteria for being errors of more abundant OTUs and merges these. It has been shown that curation with LULU consistently result
in more realistic diversity metrics.</p>
<div class="line-block">
<div class="line">This is implemented also under POSTCLUSTERING panel, <a class="reference internal" href="quicktools.html#postclustering-lulu"><span class="std std-ref">see here</span></a></div>
</div>
<hr class="docutils" />
</section>
<section id="postprocessing-deicode">
<span id="id2"></span><h2><a class="reference external" href="https://github.com/biocore/DEICODE">DEICODE</a><a class="headerlink" href="#postprocessing-deicode" title="Permalink to this heading"></a></h2>
<p>DEICODE (<a class="reference external" href="https://doi.org/10.1128/mSystems.00016-19">Martino et al., 2019</a>) is used to perform beta diversity analysis
by applying robust Aitchison PCA on the OTU/ASV table. To consider the compositional nature of data,
it preprocesses data with rCLR transformation (centered log-ratio on only non-zero values, without adding pseudo count).
As a second step, it performs dimensionality reduction of the data using robust PCA (also applied only to the non-zero values of the data),
where sparse data are handled through matrix completion.</p>
<dl class="simple">
<dt>Additional information:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://library.qiime2.org/plugins/deicode/19/">DEICODE tutorial</a></p></li>
<li><p><a class="reference external" href="https://github.com/biocore/DEICODE">DEICODE repository</a></p></li>
<li><p><a class="reference external" href="https://journals.asm.org/doi/10.1128/mSystems.00016-19">DEICODE paper</a></p></li>
</ul>
</dd>
</dl>
<div class="line-block">
<div class="line">Input data is tab delimited <strong>OTU table</strong> and optionally <strong>subset of OTU ids</strong> to generate results also for the selected subset (see input examples below).</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To <strong>START</strong>, specify working directory under <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">WORKDIR</span></code>, but the file formats do not matter here (just click ‘Next’).</p>
</div>
<div class="line-block">
<div class="line"><strong>Output</strong> files in <code class="docutils literal notranslate"><span class="pre">DEICODE_out</span></code> directory:</div>
<div class="line">#   - otutab.biom          =  full OTU table in BIOM format</div>
<div class="line">#   - rclr_subset.tsv      =  rCLR-transformed subset of OTU table *</div>
<div class="line"># DEICODE_out/full/</div>
<div class="line">#   - distance-matrix.tsv  =  distance matrix between the samples, based on full OTU table</div>
<div class="line">#   - ordination.txt       =  ordination scores for samples and OTUs, based on full OTU table</div>
<div class="line">#   - rclr.tsv             =  rCLR-transformed OTU table</div>
<div class="line"># DEICODE_out/subs/</div>
<div class="line">#   - distance-matrix.tsv  =  distance matrix between the samples, based on a subset of OTU table *</div>
<div class="line">#   - ordination.txt       =  ordination scores for samples and OTUs, based a subset of OTU table *</div>
<div class="line"># *, files are present only if ‘subset_IDs’ variable was specified</div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Setting</p></th>
<th class="head"><p>Tooltip</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">table</span></code></p></td>
<td><div class="line-block">
<div class="line">select OTU/ASV table. If no file is selected, then PipeCraft will</div>
<div class="line">look OTU_table.txt or ASV_table.txt in the working directory.</div>
<div class="line">See OTU table example below</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">subset_IDs</span></code></p></td>
<td><div class="line-block">
<div class="line">select list of OTU/ASV IDs for analysing a subset from the full table</div>
<div class="line">see subset_IDs file example below</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">min_otu_reads</span></code></p></td>
<td><div class="line-block">
<div class="line">cutoff for reads per OTU/ASV. OTUs/ASVs with lower reads then specified</div>
<div class="line">cutoff will be excluded from the analysis</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">min_sample_reads</span></code></p></td>
<td><div class="line-block">
<div class="line">cutoff for reads per sample. Samples with lower reads then</div>
<div class="line">specified cutoff will be excluded from the analysis</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Example of input <code class="docutils literal notranslate"><span class="pre">table</span></code> (tab delimited text file):</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>OTU_id</p></th>
<th class="head"><p>sample1</p></th>
<th class="head"><p>sample2</p></th>
<th class="head"><p>sample3</p></th>
<th class="head"><p>sample4</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>00fc1569196587dde</p></td>
<td><p>106</p></td>
<td><p>271</p></td>
<td><p>584</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-odd"><td><p>02d84ed0175c2c79e</p></td>
<td><p>81</p></td>
<td><p>44</p></td>
<td><p>88</p></td>
<td><p>14</p></td>
</tr>
<tr class="row-even"><td><p>0407ee3bd15ca7206</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>3</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>042e5f0b5e38dff09</p></td>
<td><p>20</p></td>
<td><p>83</p></td>
<td><p>131</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>07411b848fcda497f</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>2</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>07e7806a732c67ef0</p></td>
<td><p>18</p></td>
<td><p>22</p></td>
<td><p>83</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>0836d270877aed22c</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>0aa6e7da5819c1197</p></td>
<td><p>1</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>0c1c219a4756bb729</p></td>
<td><p>18</p></td>
<td><p>17</p></td>
<td><p>40</p></td>
<td><p>7</p></td>
</tr>
</tbody>
</table>
<p>Example of input <code class="docutils literal notranslate"><span class="pre">subset_IDs</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">07411</span><span class="n">b848fcda497f</span>
<span class="mf">042e5</span><span class="n">f0b5e38dff09</span>
<span class="mi">0836</span><span class="n">d270877aed22c</span>
<span class="mi">0</span><span class="n">c1c219a4756bb729</span>
<span class="o">...</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>PERMANOVA and PERMDISP example using the robust Aitchison distance</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>library(vegan)

## Load distance matrix
dd &lt;- read.table(file = &quot;distance-matrix.tsv&quot;)

## You will also need to load the sample metadata
## However, for this example we will create a dummy data
meta &lt;- data.frame(
  SampleID = rownames(dd),
  TestData = rep(c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;), each = ceiling(nrow(dd)/3))[1:nrow(dd)])

## NB! Ensure that samples in distance matrix and metadata are in the same order
meta &lt;- meta[ match(x = meta$SampleID, table = rownames(dd)), ]

## Convert distance matrix into &#39;dist&#39; class
dd &lt;- as.dist(dd)

## Run PERMANOVA
adon &lt;- adonis2(formula = dd ~ TestData, data = meta, permutations = 1000)
adon

## Run PERMDISP
permdisp &lt;- betadisper(dd, meta$TestData)
plot(permdisp)
</pre></div>
</div>
<p>Example of plotting the ordination scores</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>library(ggplot2)

## Load ordination scores
ord &lt;- readLines(&quot;ordination.txt&quot;)

## Skip PCA summary
ord &lt;- ord[ 8:length(ord) ]

## Break the data into sample and species scores
breaks &lt;- which(! nzchar(ord))
ord &lt;- ord[1:(breaks[2]-1)]               # Skip biplot scores
ord_sp &lt;- ord[1:(breaks[1]-1)]            # species scores
ord_sm &lt;- ord[(breaks[1]+2):length(ord)]  # sample scores

## Convert scores to data.frames
ord_sp &lt;- as.data.frame( do.call(rbind, strsplit(x = ord_sp, split = &quot;\t&quot;)) )
colnames(ord_sp) &lt;- c(&quot;OTU_ID&quot;, paste0(&quot;PC&quot;, 1:(ncol(ord_sp)-1)))

ord_sm &lt;- as.data.frame( do.call(rbind, strsplit(x = ord_sm, split = &quot;\t&quot;)) )
colnames(ord_sm) &lt;- c(&quot;Sample_ID&quot;, paste0(&quot;PC&quot;, 1:(ncol(ord_sm)-1)))

## Convert PCA to numbers
ord_sp[colnames(ord_sp)[-1]] &lt;- sapply(ord_sp[colnames(ord_sp)[-1]], as.numeric)
ord_sm[colnames(ord_sm)[-1]] &lt;- sapply(ord_sm[colnames(ord_sm)[-1]], as.numeric)

## At this step, sample and OTU metadata could be added to the data.frame

## Example plot
ggplot(data = ord_sm, aes(x = PC1, y = PC2)) + geom_point()
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quicktools.html" class="btn btn-neutral float-left" title="Individual steps (Quick Tools)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.html" class="btn btn-neutral float-right" title="Example data analyses" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sten Anslan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>